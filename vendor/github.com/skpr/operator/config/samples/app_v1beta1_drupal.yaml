apiVersion: app.skpr.io/v1beta1
kind: Drupal
metadata:
  name: sample
spec:
  nginx:
    image: nickschuch/drupal:0.0.1-nginx
    port: 80
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 100m
        memory: 128Mi
    autoscaling:
      trigger:
        cpu: 80
      replicas:
        min: 2
        max: 4
    hostAlias:
      fpm: php-fpm
  fpm:
    image: nickschuch/drupal:0.0.1-fpm
    port: 9000
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 250m
        memory: 512Mi
    autoscaling:
      trigger:
        cpu: 80
      replicas:
        min: 4
        max: 8
  volume:
    public:
      path: /data/app/sites/default/files
      class: standard
      amount: 10Gi
      permissions:
        user: skpr
        group: skpr
        file: 664
        directory: 775
        cronJob:
          image: nickschuch/drupal:0.0.1-fpm
          schedule: "*/5 * * * *"
    private:
      path: /mnt/private
      class: standard
      amount: 10Gi
      permissions:
        user: skpr
        group: skpr
        file: 664
        directory: 775
        cronJob:
          image: nickschuch/drupal:0.0.1-fpm
          schedule: "*/5 * * * *"
    temporary:
      path: /mnt/temporary
      class: standard
      amount: 10Gi
      permissions:
        user: skpr
        group: skpr
        file: 664
        directory: 775
        cronJob:
          image: nickschuch/drupal:0.0.1-fpm
          schedule: "*/5 * * * *"
  mysql:
    default:
      class: nonprod
    migration:
      class: nonprod
  cron:
    drush:
      image: nickschuch/drupal:0.0.1-cli
      command: drush cron
      schedule: "@hourly"
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 100m
          memory: 128Mi
      retries: 2
      keepSuccess: 10
      keepFailed: 10
      deadline: 300
  exec:
    image: nickschuch/drupal:0.0.1-cli
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 100m
        memory: 128Mi
  configmap:
    default:
      path: /etc/skpr/config/default
    override:
      path: /etc/skpr/config/override
  secret:
    default:
      path: /etc/skpr/secret/default
    override:
      path: /etc/skpr/secret/override
  newrelic:
    configmap:
      enabled: newrelic.enabled
      name: newrelic.name
    secret:
      license: newrelic.license
# status:
#   nginx:
#     phase: deployed
#     replicas: 2
#     metrics:
#       cpu: 25
#   fpm:
#     phase: deploying
#     replicas: 2
#     metrics:
#       cpu: 25
#   volume:
#     public:
#       name: sample-public
#       phase: Bound
#     private:
#       name: sample-private
#       phase: Bound
#     temporary: 
#       name: sample-temporary
#       phase: Bound
#   mysql:
#     default:
#       configmap:
#         name: sample-defaults
#         keys:
#           database: mysql.default.name
#           hostname: mysql.default.host
#           port: mysql.default.port
#       secret:
#         name: sample-defaults
#         keys:
#           username: mysql.default.user
#           password: mysql.default.pass
#     migration:
#       configmap:
#         name: sample-defaults
#         keys:
#           database: mysql.migration.name
#           hostname: mysql.migration.host
#           port: mysql.migration.port
#       secret:
#         name: sample-defaults
#         keys:
#           username: mysql.migration.user
#           password: mysql.migration.passw
#   cron:
#     drush:
#       lastScheduleTime: xxxxxxxxxxxxxxx 
#   configmap:
#     default:
#       name: sample-defaults
#       count: 10
#     override:
#       name: sample-overrides
#       count: 2
#   secret:
#     default:
#       name: sample-defaults
#       count: 5
#     override:
#       name: sample-overrides
#       count: 1
